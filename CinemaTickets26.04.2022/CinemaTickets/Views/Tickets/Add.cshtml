@using WebApi.Models
@{
    ViewData["Title"] = "Ticket Add";
}

<form action="/Tickets/Save" method="post">
    @{
        if (ViewBag.message != null)
        {
            <div class="alert alert-danger">@ViewBag.message</div>
        }
    }
    <div class="mb-3">
        <label class="form-label">Movie</label>
        <select id="MovieId" name="MovieId" class="form-control">
            <option>Films</option>
            @foreach (Movie movie in ViewBag.movies)
            {
                <option value="@movie.Id">@movie.Name</option>
            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Saloon</label>
        <select name="SaloonId" class="form-control">
            @foreach (Saloon saloon in ViewBag.saloons)
            {
                <option value="@saloon.Id">@saloon.Name</option>
            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Seanse</label>
        <select id="SeanseId" name="SeanseId" class="form-control">
            @foreach (Seanse seanse in ViewBag.seanses)
            {
                <option value="@seanse.Id">@seanse.MovieTime</option>
            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Seat</label>
        <select name="SeatId" class="form-control">
            @foreach (Seat seat in ViewBag.seats)
            {
                <option value="@seat.Id">@seat.Number</option>
            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Please enter your e-mail for ticket details</label>
        <input type="email" name="EMailDetail" id="EMailDetail" class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Price</label>
        <select name="PriceId" class="form-control">
            @foreach (Price price in ViewBag.prices)
            {
                <option value="@price.Id">@price.Value</option>
            }
        </select>
    </div>
    <button type="submit" class="btn btn-success  col-md-1" weight=10>Add</button>
</form>
<script>
    var movieDOM=document.getElementById("MovieId");
    var seanseDOM = document.getElementById("SeanseId");
    var priceDOM = document.getElementById("PriceId");
    movieDOM.onchange=function(event){
        console.log(this.value);
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/Tickets/GetSeanse?movieId=' + this.value, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                var data = JSON.parse(xhr.responseText);
                seanseDOM.innerHTML="";
                var option = document.createElement("option");
                option.value = data.id;
                option.text = data.movieTime;
                seanseDOM.appendChild(option);
            }
        }
        xhr.send();
    }
</script>
@*ASP.NET CORE MVC (.NET 5) | Build a Complete eCommerce App*@
